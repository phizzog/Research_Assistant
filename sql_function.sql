CREATE SQL FUNCTION TEMPLATE:
create or replace function match_sources_by_project(query_embedding vector(1536), p_project_id integer, match_count int DEFAULT 5, match_threshold float DEFAULT 0.5) returns table (id bigint, source_id text, chunk_id text, raw_text text, metadata jsonb, similarity float) language plpgsql as $$ begin return query select sources.id, sources.source_id, sources.chunk_id, sources.raw_text, sources.metadata, 1 - (sources.embedding <=> query_embedding) as similarity from sources where project_id = p_project_id AND 1 - (sources.embedding <=> query_embedding) > match_threshold order by similarity desc limit match_count; end; $$;
